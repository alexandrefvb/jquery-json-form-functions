$.fn.toJson=function(){function a(b,c,d){if(1===c.length)if(b[c[0]]){var e=b[c[0]];$.isArray(e)?e.push(d):b[c[0]]=[b[c[0]],d]}else b[c[0]]=d;else{b[c[0]]||(b[c[0]]={});var f=b[c[0]];c.splice(0,1),a(f,c,d)}}function b(a){if("string"==typeof a)return a;if($.isArray(a))for(var c in a)a[c]=b(a[c]);else for(var e in a){var f=e.match(d);f?(a[f[1]]=a[f[1]]||[],a[f[1]][parseInt(f[2])]=b(a[e]),delete a[e]):a[e]=b(a[e])}return a}function c(a,b){var e=b[0].match(d),f=e?a[e[1]][e[2]]:a[b[0]];1===b.length?f&&!$.isArray(f)&&""!==f&&(e?a[e[1]][e[2]]=[f]:a[b[0]]=[f]):(b.splice(0,1),c(f,b))}var d=/(.+)\[(\d+)\]/,e={},f=this.serializeArray();for(var g in f)if(""!==f[g].value){var h=f[g].name.split(" ").join("").split(".");a(e,h,f[g].value)}return e=b(e),this.find(".json-form-array").each(function(a,b){c(e,b.name.split(" ").join("").split("."))}),e},$.fn.postJson=function(){var a=$.ajax({type:"POST",url:this.attr("action")||window.location.href,data:JSON.stringify(this.toJson()),dataType:"json",processData:!1,contentType:"application/json; charset=UTF-8"});return a},$.fn.putJson=function(){var a=$.ajax({type:"PUT",url:this.attr("action")||window.location.href,data:JSON.stringify(this.toJson()),dataType:"json",processData:!1,contentType:"application/json; charset=UTF-8"});return a};